<!DOCTYPE html>
<html lang="en-US">
  <head>
    <title>Web Chat: Sidescrolling Activity</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://unpkg.com/react@16.8.6/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16.8.6/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/react-redux@7.1.0/dist/react-redux.min.js"></script>
    <script src="https://unpkg.com/glamor@2.20.40/umd/index.js"></script>

    <!-- This webchat.js file is built from Web Chat's 'latest' bits as of 10/16/2019-->
    <script src="/webchat.js"></script>
    <style>
      html,
      body {
        height: 100%;
        font-family: sans-serif;
      }
      body {
        margin: 0;
      }
      .header {
        height: 15%;
      }

      .block {
        padding: 10px; 
        text-align: center;
      }
      .warning {
        background-color: #FEEFB3; 
        color: #9F6000; 
        margin: auto; 
        padding: 20px;
        text-align: center;
        width: 600px; 

      }
      textarea {
        min-width: 375px;
      }
      #webchat {
        height: 85%;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div class="warning">
        <strong>WARNING: </strong>
        This sample dangerously sets HTML and is not recommended.
      </div>
      <div class="block">
        Copy the below text into the send box to initiate the sample.
      </div>
      <div class="block">
        <textarea>
echo <table><tbody><tr><td><nobr>ABCDEFGHIJKLMNOPQRSTUVWXYZ</nobr></td><td><nobr>ABCDEFGHIJKLMNOPQRSTUVWXYZ</nobr></td><td><nobr>ABCDEFGHIJKLMNOPQRSTUVWXYZ</nobr></td><td><nobr>ABCDEFGHIJKLMNOPQRSTUVWXYZ</nobr></td><td><nobr>ABCDEFGHIJKLMNOPQRSTUVWXYZ</nobr></td><td><nobr>ABCDEFGHIJKLMNOPQRSTUVWXYZ</nobr></td><td><nobr>ABCDEFGHIJKLMNOPQRSTUVWXYZ</nobr></td><td><nobr>ABCDEFGHIJKLMNOPQRSTUVWXYZ</nobr></td><td><nobr>ABCDEFGHIJKLMNOPQRSTUVWXYZ</nobr></td><td><nobr>ABCDEFGHIJKLMNOPQRSTUVWXYZ</nobr></td><td><nobr>ABCDEFGHIJKLMNOPQRSTUVWXYZ</nobr></td></tr></tbody></table>
            </textarea>
          </div>
      </div>
    </div>
    <div id="webchat" role="main"></div>
    <script type="text/babel">
      (async function() {
        "use strict";

        const { connectToWebChat, ReactWebChat } = window.WebChat;

        const { css } = window.Glamor;

        const SIDESCROLL_CSS = css({
          position: "relative",
          overflowX: "auto",
          width: "100%"
        });

        const AttachmentMiddlewareWithSideScroll = ({ card }) => (
          <div
            className={SIDESCROLL_CSS}
            dangerouslySetInnerHTML={{ __html: card.activity.text }}
          />
        );

        const attachmentMiddleware = () => next => card => {
          if (card.attachment && /^</.test(card.attachment.content)) {
            return <AttachmentMiddlewareWithSideScroll card={card} />;
          }
          return next(card);
        };

        const res = await fetch(
          "https://webchat-mockbot.azurewebsites.net/directline/token",
          { method: "POST" }
        );
        const { token } = await res.json();

        window.ReactDOM.render(
          <ReactWebChat
            attachmentMiddleware={attachmentMiddleware}
            directLine={window.WebChat.createDirectLine({ token })}
            styleOptions={{
              botAvatarInitials: "WC",
              userAvatarInitials: "CG"
            }}
          />,
          document.getElementById("webchat")
        );

        document.querySelector("#webchat > *").focus();
      })().catch(err => console.error(err));
    </script>
  </body>
</html>
